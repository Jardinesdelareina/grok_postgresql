# DataFarm PG

### Что это

Изначально проект <b>DataFarm</b> планировался как "домашний" торговый бот, который должен был запускаться на локальной машине или в крайнем случае на VPS-сервере. Он таким и был [реализован на Python](https://github.com/Jardinesdelareina/datafarm). Проект был доведен до своего логического завершения и на нем была поставлена точка. Не потому, что алгоритм, описаный в данной торговой системе, не оправдал ожиданий, напротив, он показал себя весьма достойно. Причина прекращения поддержки проекта DataFarm кроется в смене взглядов относительно активной торговли на финансовых рынках. Но это не тема данного превью.

<b>DataFarm</b> это, в первую очередь, хранилище данных о криптовалютных транзакциях. Функционал обновленного Datafarm следующий: Создание пользователя, создание пользователем своего инвестиционного портфеля, совершение в портфеле транзакций (BUY/SELL) по торговым стратегиям. Функционал позволяет отслеживать баланс и equity как каждого портфеля, так и пользователя в общем по итогу всех созданных портфелей. Разграничение транзакций по портфелям позволяет разграничивать торговую деятельность по тематике портфеля (либо по любому другому признаку).


<div>
    <img src="https://github.com/devicons/devicon/blob/master/icons/postgresql/postgresql-original-wordmark.svg" width="80" height="80"/>&nbsp;
    <img src="https://github.com/devicons/devicon/blob/master/icons/python/python-original-wordmark.svg" width="80" height="80"/>&nbsp;
    <img src="https://github.com/devicons/devicon/blob/master/icons/docker/docker-original-wordmark.svg" width="80" height="80"/>&nbsp;
</div>

1. Реализация всего функционала проекта возложена на СУБД <b>PostgreSQL</b>. 
2. Вспомогательный <b>Python</b>-скрипт отвечает за запись котировок в базу данных в режиме реального времени.
3. Проект разделен на два <b>Docker</b>-контейнера: один с PostgreSQL, другой с ETL-процессом. 

При запуске контейнеров происходит инициализация базы данных. Затем подключается ETL-процесс и наполняет ключевую таблицу рыночными данными, на основании которых и происходят все расчеты в данном сервисе.


### Зачем

Чтобы научиться разрабатывать базы данных нужно разрабатывать базы данных. 
А чтобы научиться администрировать базы данных, как ни странно, нужно администрировать базы данных. 

Но если разработка, проектирование, программирование - это процесс, требующий ручки и бумаги (компьютера и IDE), то администрирование требует как минимум работающего сервера, на котором крутится кластер PostgreSQL. Обучение на практике - это лучший способ научиться что-то делать хорошо. Поэтому в корневой директории проекта находится файл, активирующий процесс генерации данных. Этот процесс эмулирует работу сервиса как будто если бы все эти действия совершали реальные люди: создание пользователей, создание портфелей, совершение транзакций. С течением времени данных будет становиться все больше, что будет увеличивать нагрузку на сервер.

Обучение администрированию базы данных PostgreSQL на работающем сервере - одна из целей, ради чего создавался DataFarm.


### Как

1. `git clone datafarm_pg`      клонировать репозиторий

В корневой директории проекта нужно создать файл `.env`, в который необходимо поместить данные типа:
```
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=db
POSTGRES_DB=datafarm
```

2. `sudo docker compose up --build --force-recreate --remove-orphans`        запустить контейнеры

3. `sudo docker exec -it database bash`       войти в терминал работающего контейнера

4. `psql -d $POSTGRES_DB -U $POSTGRES_USER -f /docker-entrypoint-initdb.d/generate_data.sql`        активировать генерацию данных

Для того, чтобы войти в терминал psql, нужно ввести в новой вкладке команду:
`psql -d $POSTGRES_DB -U $POSTGRES_USER`

В случае остановки контейнера данные исчезают. Это можно исправить, прописав в файле <b>docker-compose.yml</b> в `volume` директорию, где будут сохраняться данные.

`sudo docker compose down --rmi all`        остановка контейнеров и удаление образов, связанных с ними