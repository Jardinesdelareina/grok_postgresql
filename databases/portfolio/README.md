# Документация к базе данных Portfolio

Portfolio - это сервис для составления криптовалютных портфелей. Как происходит процесс формирования портфеля: сначала зарегистрированный в системе пользователь создает портфель, определив его название и область видимости (публичный / не публичный). Далее происходит создание транзакций - пользователь изменяет баланс своего портфеля торговыми операциями операциями BUY или SELL. Таким образом если определенного актива на балансе пользователя больше 0, то его стоимость будет изменяться в зависимости от цены актива на бирже. 

У пользователя может быть несколько портфелей. Можно следить как за балансом отдельного портфеля, так и за совокупным балансом всех портфелей пользователя.


### Схема 'qts'

##### Таблица 'quotes'

Таблица представляет собой хранилице исторических данных о ценовых изменениях криптовалют. Данные загружаются порциями - каждую минуту по каждому тикеру. Таблица партиционируется помесячно.

|FK|PK|Column|Type|Length|Unique|Nullable|Description|
|---|---|---|---|---|---|---|---|
|||m_symbol|varchar|10||*|Название тикера|
|||m_time|timestamptz|||*|Время записи|
|||m_open|real|||*|Цена открытия|
|||m_high|real|||*|Наибольшая цена за период|
|||m_low|real|||*|Наименьшая цена за период|
|||m_close|real|||*|Цена закрытия|


### Схема 'ms'

##### Таблица 'users'

Таблица пользователей сервиса.

|FK|PK|Column|Type|Length|Unique|Nullable|Description|
|---|---|---|---|---|---|---|---|
||*|id|int||*|*|Идентификатор записи|
|||email|varchar|255|*|*|Адрес электронной почты пользователя|
|||password|varchar|100||*|Зашифрованный пароль пользователя|

Ограничения:

|Title|Column|Description|
|---|---|---|
|valid_email|email|Валидация ввода электронной почты|


##### Таблица 'portfolios'

Портфели пользователей. 

|FK|PK|Column|Type|Length|Unique|Nullable|Description|
|---|---|---|---|---|---|---|---|
||*|id|int||*|*|Идентификатор записи|
|||title|varchar|200|*|*|Название портфеля|
||is_published|bool||||*|Публичный / не публичный, по-умолчанию публичный|
|users(id)||fk_user_id|int|||*|Идентификатор пользователя, кому принадлежит портфель|


##### Таблица 'currencies'

Криптовалюты. 

|FK|PK|Column|Type|Length|Unique|Nullable|Description|
|---|---|---|---|---|---|---|---|
||*|id|int||*|*|Идентификатор записи|
|||symbol|varchar|10||*|Тикер криптовалюты|
|||description|text||||Описание криптовалюты|

Ограничения:

|Title|Column|Description|
|---|---|---|
|valid_symbol|symbol|Валидация названия тикера, создание определенного списка тикеров|


##### Таблица 'transactions'

Транзакции, совершаемые пользователями в рамках своих портфелей. 

|FK|PK|Column|Type|Length|Unique|Nullable|Description|
|---|---|---|---|---|---|---|---|
||*|id|bigint||*|*|Идентификатор записи|
|||action_type|varchar|4||*|Тип транзакции, по-умолчанию BUY|
|||quantity|real|||*|Количество криптовалюты в транзакции|
|||created_at|timestamptz|||*|Время создания транзакции, по-умолчанию текущее время|
|portfolios(id)||fk_portfolio_id|int|||*|Идентификатор портфеля, в рамках которого происходит транзакция|
|currencies(id)||fk_currency_id|int|||*|Идентификатор криптовалюты, с которой происходит транзакция|

Ограничения:

|Title|Column|Description|
|---|---|---|
|valid_action_type|action_type|Валидация типа действия, выбор типа транзакции - BUY или SELL|
