# Разработка баз данных (базовые принципы)

### Правильная структура базы данных

Вот некоторые важные концепции и принципы, которые следует учитывать при проектировании правильной структуры базы данных:


1. <b>Нормализация данных</b>: это процесс разбивки таблицы на более мелкие и связанные таблицы для устранения избыточных данных и повышения целостности данных. 

Хорошая структура базы данных крайне важна для эффективной и надежной работы приложения. Она помогает организовать данные таким образом, чтобы они были легко доступны, масштабируемы и поддерживали целостность. В БД наиболее часто используемы такие нормальные формы, такие как первая, вторая и третья (1NF, 2NF, 3NF) для достижения оптимальной структуры данных.  

2. <b>Определение сущностей и их атрибутов</b>: правильная структура БД должна быть основана на анализе предметной области и определении основных сущностей (таких как пользователи, продукты, заказы) и их соответствующих атрибутов (например, идентификатор, имя, дата). Каждая сущность должна иметь уникальный идентификатор.

3. <b>Определение связей между сущностями</b>: в БД сущности обычно связаны между собой. Связи можно определить, добавив внешние ключи (foreign keys) - столбцы, которые связывают сущность с другой сущностью. Например, в таблице "заказы" может быть внешний ключ, который ссылается на идентификатор пользователя.

4. <b>Использование индексов</b>: индексы помогают ускорить поиск и выборку данных. Они создаются на часто используемых столбцах для быстрого доступа к данным. Однако не следует создавать слишком много индексов, так как они могут замедлить производительность при обновлении данных.

5. <b>Разбиение данных на таблицы</b>: данные могут быть разбиты на несколько таблиц со схожими атрибутами для улучшения производительности и обслуживания. Например, таблицы "пользователи" и "адреса" могут быть разделены для более эффективного выполнения запросов.

6. <b>Обеспечение целостности данных</b>: целостность данных относится к сохранению и поддержанию корректности данных в БД. Это включает в себя определение ограничений (constraints), таких как уникальность, ссылочная целостность, ограничения целостности (check constraints) и триггеры, чтобы предотвращать недопустимые или некорректные данные.

7. <b>Учет производительности и масштабируемости</b>: при проектировании структуры БД необходимо учитывать предполагаемое количество данных, предполагаемую производительность и масштабируемость. Денормализация - процесс добавления повторяющейся информации в БД для оптимизации производительности, но это должно быть сбалансировано с обеспечением целостности данных.

8. <b>Безопасность данных</b>: структура БД также должна быть разработана с учетом аспектов безопасности данных, таких как правила контроля доступа, шифрование и контроль целостности.


### Процесс проектирования базы данных

1. Определение назначения базы данных

    Рекомендуется записать на бумаге назначение базы данных: ее цель, предполагаемое применение и список пользователей, которые будут с ней работать. Небольшой базе данных для домашнего бизнеса можно дать простое определение, например: "База данных содержит сведения о клиентах и используется для почтовой рассылки и создания отчетов". Для более сложной базы данных, с которой будет работать множество людей, как это часто бывает в больших организациях, определение может состоять из нескольких абзацев, включая время и способы использования ее разными людьми. Идея состоит в том, чтобы детально сформулировать определение, к которому затем можно обращаться в процессе проектирования. Такое определение поможет сосредоточиться на целях и задачах при принятии решений.


2. Поиск и упорядочивание необходимых сведений

    Чтобы найти и упорядочить необходимые сведения, нужно начать с имеющейся информации. Например, можно записывать заказы на покупку в реестр или хранить сведения о клиентах в бумажных формах. Соберите эти документы и выведите список всех типов отображаемых сведений (например, каждое поле, которое вы заполняете в форме). Если нет существующих форм, представьте, что нужно создать форму для записи сведений о клиенте. Какую информацию вы бы поместили в форму? Какие поля заполнения создадите? Определите и перечислите каждый из этих элементов.

    При подготовке списка не старайтесь придать ему законченный вид с первого раза. Записывайте все элементы, которые приходят в голову. Если с базой данных будет работать кто-то еще, попросите их внести свои предложения. Позднее вы сможете скорректировать список.


3. Разделение данных по таблицам

    Чтобы распределить данные по таблицам, нужно выделить основные группы или темы. Выбрав тему для таблицы, проследите, чтобы столбцы в ней содержали сведения только по этой теме. Например, в таблице товаров должны храниться сведения только о товарах. Поскольку адрес поставщика относится к сведениям о поставщиках, а не о товарах, он должен храниться в таблице поставщиков.

    При проектировании базы данных всегда записывайте каждый факт только один раз. Если сведения повторяются (например, адрес конкретного поставщика), нужно поместить их в отдельную таблицу.

    Например, предположим, что есть только один товар, поставляемый компанией Coho Winery, и нужно удалить этот товар, но сохранить имя и адрес поставщика. Как удалить запись о товаре, не потеряв сведений о поставщике? Это невозможно. Поскольку каждая запись содержит сведения и о товаре, и о поставщике, нельзя удалить их по отдельности. Чтобы разделить эти сведения, необходимо сделать из одной таблицы две: одну — для сведений о товаре, другую — для сведений о поставщике. Тогда удаление записи о товаре не приведет к удалению записи о поставщике.


4. Преобразование элементов данных в столбцы

    После определения первоначального набора столбцов для каждой таблицы можно уточнять и дополнять их. Например, удобно хранить имя и фамилию клиента в разных столбцах, чтобы проще было выполнять сортировку, поиск и индексирование только по этим столбцам. Адрес также состоит из нескольких компонентов (собственно адреса, города, области, почтового индекса и страны), которые лучше хранить в отдельных столбцах. Например, если нужно выполнить поиск, фильтрацию или сортировку по областям, потребуется, чтобы сведения об областях хранились в отдельном столбце.


5. Задание первичных ключей

    Каждая таблица должна содержать столбец или набор столбцов для однозначного определения каждой строки таблицы. Часто для этого используется уникальный идентификационный номер, например код сотрудника или серийный номер. В базах данных эти сведения называются первичным ключом таблицы. Используя поля первичных ключей, СУБД быстро связывает данные из нескольких таблиц и сводит их воедино.
     
    * У первичного ключа всегда должно быть значение. Если в какой-то момент столбец может содержать   неназначенное или неизвестное (отсутствующее) значение, его нельзя использовать в качестве компонента первичного ключа.

    * В первичном ключе не должно быть повторяющихся значений. Например, не следует использовать в качестве первичного ключа имена людей, поскольку они не уникальны. С большой долей вероятности в одной таблице могут оказаться двое людей с одинаковыми именами.

    * Всегда выбирайте первичный ключ, значение которого не изменится. В базе данных с несколькими таблицами первичный ключ одной таблицы может использоваться в качестве ссылки в других таблицах. Если первичный ключ изменяется, это изменение необходимо применить ко всем ссылкам на этот ключ. Используя неизменяемый первичный ключ, вы снижаете вероятность нарушения синхронизации с другими таблицами. Идентификаторы без фактов идеально подходят для использования в качестве первичного ключа, так как они не изменяются. Первичный ключ, содержащий факты о строке, например номер телефона или имя клиента, скорее всего, изменится, так как сама фактическая информация может измениться.


6. Настройка связей между таблицами

    * <b>One To Many</b> (Один ко многим)
    * <b>Many To Many</b> (Многие ко многим)
    * <b>One To One</b> (Один к одному)


7. Усовершенствование структуры базы данных

    При внимательном изучении первоначальной базы данных вы наверняка увидите, где ее можно улучшить. Вот некоторые моменты, которые нужно проверить:

    * Не забыли ли вы какие-то столбцы? Если да, относятся ли эти сведения к имеющимся таблицам? Если это сведения по другой теме, возможно, потребуется создать еще одну таблицу. Создайте столбец для каждого элемента данных, который нужно отслеживать. Если данные невозможно получить из других столбцов путем вычислений, скорее всего, для них нужен новый столбец.

    * Есть ли ненужные столбцы, значения которых получаются из других полей с помощью вычислений? Если элемент данных можно получить из других столбцов с помощью вычислений (например, цену со скидкой можно вычислять на основе розничной цены), лучше не создавать для него новый столбец.

    * Приходится ли вам неоднократно вводить одни и те же сведения в одной из таблиц? Если да, вам нужно разделить одну таблицу на две и установить между ними связь "один ко многим".

    * У вас есть таблицы с большим количеством полей, ограниченным количеством записей и множеством пустых полей в отдельных записях? Если да, подумайте о том, как изменить структуру таблицы, чтобы в ней было меньше полей и больше записей.

    * Каждый элемент данных разделен на минимальные полезные фрагменты? Поместите в отдельный столбец каждый элемент данных, который необходимо использовать для отчетов, сортировки, поиска или вычислений.

    * Данные в каждом столбце соответствуют теме таблицы? Если столбец содержит данные, которые не относятся к теме таблицы, их нужно поместить в другую таблицу.

    * Представлены ли все связи между таблицами, либо общими полями, либо третьей таблицей? Для связей "один к одному" и "один ко многим" требуются общие столбцы. Для связей "многие ко многим" требуется третья таблица.


8. Применение правил нормализации

    Нормализацию лучше всего выполнять после внесения в базу данных всех элементов данных и получения предварительной структуры. Цель этого процесса — убедиться в том, что элементы данных распределены по соответствующим таблицам. Правильность самих элементов данных при нормализации не проверяется.

    Правила нормализации нужно применять последовательно, проверяя на каждом этапе соответствие структуры базы данных одной из так называемых "нормальных форм". Обычно применяются пять нормальных форм — с первой по пятую. В этой статье рассматриваются первые три формы, поскольку их достаточно для большинства структур баз данных.


    <em>Первая нормальная форма</em>

    * Отсутствуют строки-дубликаты
    * Все атрибуты простых типов данных
    * Все значения скалярны (одно поле - одно значение простого типа)


    <em>Вторая нормальная форма</em>

    * Таблица удовлетворяет условия первой нормальной формы
    * Есть первичный ключ (PRIMARY KEY)
    * Все атрибуты описывают PK целиком, а не его часть


    <em>Третья нормальная форма</em>

    * Таблица удовлетворяет условия второй нормальной формы
    * Нет зависимостей одних неключевых атрибутов от других (все атрибуты зависят только от PK)