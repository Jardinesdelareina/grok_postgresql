-----------------------------------------------------
# Файл конфигурации аутентификации клиента PostgreSQL
-----------------------------------------------------

Этот файл контролирует: 

* каким хостам разрешено подключаться, 
* как клиенты аутентифицированы, 
* какие имена пользователей PostgreSQL они могут использовать, 
* какие есть базы данных, к которым они могут получить доступ. 

Записи принимают одну из следующих форм:

`<Тип_подключения>____<База данных>____<Пользователь>____<Метод>____[<Опции>]`


### Тип подключения (TYPE)

* `local` - сокет Unix-домена
* `host` - сокет TCP/IP (зашифрованный или нет)
* `hostssl` - сокет TCP/IP, зашифрованный с помощью SSL
* `hostnossl` - сокет TCP/IP, не зашифрованный с помощью SSL
* `hostgssenc` - сокет TCP/IP, зашифрованный GSSAPI
* `hostnogssenc` - сокет TCP/IP, не зашифрованный с помощью GSSAPI


### База данных (DATABASE)

* `all` - любая база данных
* `sameuser` - база данных, совпадающая по имени с ролью
* `samerole` - база данных, совпадающая по имени с ролью или группой, в которую входит
* `replication` - специальное разрешение для протокола репликации

Имя базы данных или ее список разделен запятыми. Ключевое слово `all` не включает в себя репликации. Доступ к репликации необходимо включить в отдельной записи.


### Пользователь (USER)

* `all`
* имя пользователя
* имя группы с префиксом «+»
* список имен, разделенный запятыми 

В полях DATABASE и USER вы также можете написать имя файла с префиксом «@», чтобы включить имена из отдельного файла.


### Адрес (ADDRESS)

* `all` - любой IP-адрес
* IP-адрес/маска CIDR
* `samehost` - IP-адрес сервера
* `samenet` - любой IP-адрес из любой подсети, к которой подключен сервер
* доменное имя - IP-адрес, соответствующий указанному имени

ADDRESS указывает набор хостов, которым соответствует запись. Это может быть имя хоста или оно состоит из IP-адреса и маски CIDR, целое число (от 0 до 32 (IPv4) или 128 (IPv6) включительно), которое определяет количество значащих битов в маске. Имя хоста имя, начинающееся с точки (.), соответствует суффиксу фактического имени хоста. Альтернативно, вы можете написать IP-адрес и маску сети отдельно столбцы для указания набора хостов. Вместо CIDR-адреса вы можете написать `samehost`, чтобы оно соответствовало любому IP-адресу сервера, или `samenet`, чтобы соответствовать любому адресу в любой подсети, к которой принадлежит сервер.


### Метод (METHOD)

* `trust` - этот метод доверяет всем клиентам, не требуя аутентификации. Это означает, что любой пользователь, имеющий доступ к серверу, получит доступ к базе данных без проверки пароля.
* `reject` - с помощью этого метода все подключения будут отклонены, что формально означает, что доступ к базе данных невозможен.
* `md5` - этот метод использует хеширование MD5 для хранения паролей пользователей в зашифрованном виде.
* `password` - утентификация происходит путем сравнения пароля, отправленного клиентом, с хранящимся в базе данных.
* `scram-sha-256` - этот метод также использует механизм хеширования для аутентификации, но более безопасный и современный стандарт SHA-256.
* `gss` - аутентификация с использованием протокола GSSAPI (Generic Security Service Application Program Interface).
* `sspi` - метод аутентификации для Windows-пользователей, использующий SSPI (Security Support Provider Interface).
* `ident` - проверка пары происходит через службу ident, работающую на удаленной машине.
* `peer` - пользовательский идентификатор операционной системы (OS User ID) используется для аутентификации.
* `pam` - использует Pluggable Authentication Modules для аутентификации пользователей.
* `ldap` - аутентификация происходит через LDAP-каталог.
* `radius` - используется протокол RADIUS для аутентификации.
* `cert` - аутентификация на основе SSL-сертификатов.

Обратите внимание, что `password` отправляет пароли в виде открытого текста; `md5` или `scram-sha-256` предпочтительнее, поскольку они отправляют зашифрованные пароли.


### Опции (OPTIONS)

ОПЦИИ — набор опций аутентификации в формате ИМЯ=ЗНАЧЕНИЕ. Доступные параметры зависят от различных методов аутентификации.


-------------------------------------------------------------------------------------------------------

Этот файл читается при запуске сервера и когда сервер получает сигнал SIGHUP. Если вы редактируете файл в работающей системе, вам придется перезагрузить сервер, чтобы изменения вступили в силу. Для этого запустите `pg_ctl reload`, или выполните команду:
```sql
SELECT pg_reload_conf();
```

----------------------------------------------
### Разместите здесь свою фактическую конфигурацию
----------------------------------------------

Если вы хотите разрешить нелокальные подключения, вам нужно добавить больше `host` записей. В этом случае вам также потребуется прослушивать нелокальный интерфейс через параметр `listen_addresses` конфигурации или через ключи командной строки -i или -h.

НЕ ОТКЛЮЧАТЬ!
Если вы измените эту первую запись, вам необходимо убедиться, что Суперпользователь базы данных может получить доступ к базе данных, используя другой метод. При автоматическом режиме требуется неинтерактивный доступ ко всем базам данных (настраиваемые ежедневные задания cron, репликация и подобные задачи).

##### Административный вход в базу данных через доменный сокет Unix
`local___all_____________postgres______________________________peer`


`TYPE___DATABASE__________USER_______________ADDRESS___________METHOD`

##### "local" предназначен только для соединений сокетов домена Unix.
`local___all_______________all__________________________________peer`

##### IPv4 local connections (Локальные соединения IPv4):
`host____all_______________all______________127.0.0.1/32________peer`

##### IPv6 local connections (Локальные соединения IPv6):
`host____all_______________all________________::1/128___________peer`


##### Разрешить подключения репликации с локального хоста пользователем с привилегиями репликации.
`local___replication_______all__________________________________peer`


`host____replication_______all______________127.0.0.1/32_______scram-sha-256`
`host____replication_______all________________::1/128__________scram-sha-256`


-------------------------------------------------------------------------------------------------------

Пример конфигурации:

##### TYPE__________DATABASE_____USER__________ADDRESS____________METHOD
`hostnossl_____all_______all_______all____________reject`

`host________sameuser____all_____samenet__________trust`

`host________db_name____+reader____all____________trust`


В данной конфигурации указано, что во-первых - любому подключению через нешифрованное соединение в доступе будет отказано. Это условие указано самой первой строчкой и является первостепенным параметром в конфигурации (чтение происходит сверху вниз построчно). Если подключение с шифрованием происходит <b>к базе данных, чье имя совпадает с именем пользователя</b> (при этом имя пользователя может быть любым (`all`)), а адрес допускается только из тех сетей, к которым подключен сервер PostgreSQL - в таком случае <b>происходит подключение к базе данных</b> (`trust`). Если подключение не удовлетворяет условия второй строки, смотрим условия следующей строки: подключение произойдет к конкретной базе данных пользователю с ролью `reader` или любой ролью, выданной ролью `reader`, при этом подключение может происходить с любого адреса. 